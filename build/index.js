(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("react");var n=e.n(t);const a=require("react-dom");var o=e.n(a);const r=require("react-chatbot-kit"),c=function(){return n().createElement("div",{className:"bot-avatar"},n().createElement("img",{src:"/icons/bot.svg",alt:"Bot"}))},s=function(){return n().createElement("div",{className:"user-avatar"},n().createElement("img",{src:"/icons/user-alt.svg",alt:"User"}))},i=function(){return n().createElement("div",{className:"custom-header"},n().createElement("img",{src:"/icons/volvo_logo.png",alt:"Volvo Logo",className:"logo"}),n().createElement("div",{className:"header-text volvo-font"},n().createElement("h3",null,"Volvo Support Assistant")))},l={initialMessages:[(0,r.createChatBotMessage)("Welcome to Volvo Support! How can I assist you today?"),(0,r.createChatBotMessage)("I can help with equipment information, maintenance schedules, and parts inquiries.")],botName:"Volvo Support",customStyles:{botMessageBox:{backgroundColor:"#003057"},chatButton:{backgroundColor:"#003057"}},customComponents:{header:function(){return n().createElement(i,null)},botAvatar:function(){return n().createElement(c,null)},userAvatar:function(){return n().createElement(s,null)}}},u=function(){function e(e,t){this.actionProvider=e,this.state=t}return e.prototype.parse=function(e){var t=e.toLowerCase();t.includes("hello")||t.includes("hi")?this.actionProvider.handleGreeting():t.includes("help")?this.actionProvider.handleHelp():t.includes("live chat")||t.includes("technician")||t.includes("person")||t.includes("agent")?this.actionProvider.handleLiveChatRequest():this.actionProvider.handleDefault()},e}();var m=function(){return m=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},m.apply(this,arguments)},h=function(e,t,n){if(n||2===arguments.length)for(var a,o=0,r=t.length;o<r;o++)!a&&o in t||(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};const p=function(){function e(e,t,n){this.createChatBotMessage=e,this.setState=t,this.createClientMessage=n}return e.prototype.handleGreeting=function(){var e=this.createChatBotMessage("Hello! Nice to meet you!");this.updateChatbotState(e)},e.prototype.handleHelp=function(){var e=this.createChatBotMessage("I can respond to greetings and help commands. Try saying 'hello' or asking for 'help'. If you need to talk to a real person, say 'live chat'.");this.updateChatbotState(e)},e.prototype.handleLiveChatRequest=function(){var e=this,t=this.createChatBotMessage("I'll connect you with a technician right away. Please wait a moment...");this.updateChatbotState(t),setTimeout((function(){e.switchToLiveChat&&e.switchToLiveChat()}),1500)},e.prototype.handleDefault=function(){var e=this.createChatBotMessage("I'm not sure how to respond to that. Try asking for help or type 'live chat' to connect with a technician.",{withAvatar:!0});this.updateChatbotState(e)},e.prototype.updateChatbotState=function(e){this.setState((function(t){return m(m({},t),{messages:h(h([],t.messages,!0),[e],!1)})}))},e}(),g=function(e){var t=e.onClick,a=e.isOpen;return n().createElement("button",{className:"chatbot-toggle "+(a?"open":""),onClick:t,"aria-label":"Toggle Chatbot"},n().createElement("img",{src:"/icons/R2D2.png",alt:"Chatbot",className:"toggle-icon"}))},d=require("socket.io-client");var v=process.env.REACT_APP_BACKEND_URL?process.env.REACT_APP_BACKEND_URL.replace(/^http/,"ws"):window.location.hostname.includes("github.dev")?"wss://"+window.location.hostname.replace("-3000","-5000"):"ws://localhost:5000";console.log("[SOCKET LOG]: Attempting to connect to WebSocket server at "+v);var f=localStorage.getItem("token"),E=(0,d.io)(v,{transports:["websocket"],reconnection:!0,reconnectionAttempts:10,timeout:2e4,auth:{token:f}});E.on("connect",(function(){console.log("[SOCKET LOG]: Connected to server with ID: "+E.id)})),E.on("disconnect",(function(e){console.log("[SOCKET LOG]: Disconnected from server. Reason: "+e)})),E.on("connect_error",(function(e){console.error("[SOCKET ERROR]: Connection error",e),console.error("[SOCKET ERROR DETAILS]:",e.message)})),E.on("reconnect_attempt",(function(e){console.log("[SOCKET LOG]: Reconnection attempt #"+e)})),E.on("reconnect_failed",(function(){console.error("[SOCKET ERROR]: Reconnection failed after maximum attempts")})),E.onAny((function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.log("[SOCKET EVENT]: "+e,t)})),E.on("chat_message",(function(e){console.log("[CHAT EVENT]: Received chat message",e)})),E.on("chat_error",(function(e){console.error("[CHAT ERROR]:",e)})),E.on("message",(function(e){console.log("Received message:",e)}));var C=E.emit;E.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.log("[SOCKET EMIT]: Event: "+e,t),C.apply(E,function(e,t,n){if(n||2===arguments.length)for(var a,o=0,r=t.length;o<r;o++)!a&&o in t||(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))}([e],t,!0))};const y=E,b=function(e){var a=e.onSendMessage,o=e.onTyping,r=(0,t.useState)(""),c=r[0],s=r[1],i=(0,t.useState)(null),l=i[0],u=i[1],m=function(){c.trim()||l?(a({message:c,attachment:l}),s(""),u(null)):console.warn("Cannot send an empty message.")};return n().createElement("div",{className:"message-input"},n().createElement("label",{className:"attachment-icon"},n().createElement("img",{src:"/icons/paper-plane.svg",alt:"Attach"}),n().createElement("input",{type:"file",onChange:function(e){var t=e.target.files[0];t&&u(t)},style:{display:"none"}})),n().createElement("input",{type:"text",value:c,onChange:function(e){s(e.target.value),o()},onKeyPress:function(e){"Enter"===e.key&&m()},placeholder:"Type a message..."}),n().createElement("button",{onClick:m,disabled:!c.trim()&&!l,className:"send-button"},n().createElement("img",{src:"/icons/plane-alt.svg",alt:"Send"})))};var S=function(e,t,n){if(n||2===arguments.length)for(var a,o=0,r=t.length;o<r;o++)!a&&o in t||(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};const w=function(){var e=(0,t.useState)([]),a=e[0],o=e[1],r=(0,t.useState)({name:"Connecting...",id:"Connecting...",status:"Connecting..."}),c=r[0],s=r[1];return(0,t.useEffect)((function(){return y.emit("joinLiveChatQueue",{name:"Customer",issue:"Equipment assistance",machine:"Volvo CE Excavator",priority:"Medium"}),y.on("technicianConnected",(function(e){s({name:e.name||"Support Agent",id:e.technicianId||"Wvv4T9V3qNFMHw6bAAA",status:"Online"})})),y.on("message",(function(e){o((function(t){return S(S([],t,!0),[e],!1)}))})),function(){y.off("technicianConnected"),y.off("message")}}),[]),n().createElement("div",{className:"chat-container"},n().createElement("div",{className:"chat-sidebar"},n().createElement("h3",null,"TECHNICIAN DETAILS"),n().createElement("p",null,n().createElement("strong",null,"Name:")," ",c.name),n().createElement("p",null,n().createElement("strong",null,"ID:")," ",c.id),n().createElement("p",null,n().createElement("strong",null,"Status:")," ",c.status)),n().createElement("div",{className:"chat-main"},n().createElement("div",{className:"chat-window"},a.map((function(e,t){return n().createElement("div",{key:t,className:"message "+(e.fromUser?"sent":"received")},n().createElement("div",{className:"message-content"},e.text||e.message,n().createElement("div",{className:"timestamp"},new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))))}))),n().createElement("div",{className:"chat-actions"},n().createElement("button",{className:"end-chat-button",onClick:function(){window.confirm("Are you sure you want to end this chat?")&&(y.emit("endChat",{customerId:y.id}),window.location.href="/")}},"End Chat")),n().createElement("div",{className:"message-input-container"},n().createElement(b,{onSendMessage:function(e){var t="string"==typeof e?e:e.message,n={text:t,fromUser:!0,timestamp:Date.now()};o((function(e){return S(S([],e,!0),[n],!1)})),y.emit("message",{to:c.id,message:t})},onTyping:function(){return y.emit("customerTyping")}}))))};require("react-chatbot-kit/build/main.css");var N=function(){return N=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},N.apply(this,arguments)};o().render(n().createElement(n().StrictMode,null,n().createElement((function(){var e=(0,t.useState)(!1),a=e[0],o=e[1],c=(0,t.useState)(!1),s=c[0],i=c[1];return n().createElement("div",{className:"app-container"},n().createElement("div",{className:"welcome-message"},n().createElement("h1",null,"Welcome to Volvo Support"),n().createElement("p",null,"Click the chat button to get assistance")),a&&!s&&n().createElement("div",{className:"chatbot-container volvo-font"},n().createElement(r.Chatbot,{config:l,messageParser:u,actionProvider:N(N({},p),{switchToLiveChat:function(){o(!1),i(!0)}})})),s&&n().createElement("div",{className:"livechat-container"},n().createElement(w,null)),n().createElement(g,{onClick:function(){o((function(e){return!e})),s&&i(!1)},isOpen:a||s}))}),null)),document.getElementById("root")),module.exports={}})();